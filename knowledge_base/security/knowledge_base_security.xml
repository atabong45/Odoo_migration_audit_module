<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <!-- Règle d'enregistrement pour les Articles -->
        <record id="knowledge_article_contributor_rule" model="ir.rule">
            <field name="name">Articles: Les contributeurs ne modifient que leurs propres brouillons</field>
            <field name="model_id" ref="model_knowledge_article"/>
            <!-- Cette règle s'applique UNIQUEMENT au groupe Contributeur -->
            <!-- Elle ne s'appliquera PAS au groupe Admin, même s'il hérite du groupe Contributeur -->
            <field name="groups" eval="[(4, ref('group_knowledge_base_contributor'))]"/>
            
            <!-- On n'a pas besoin de restreindre la lecture, tout le monde peut tout lire -->
            <field name="perm_read" eval="1"/> 
            
            <!-- Par contre, on restreint l'écriture, la création et la suppression -->
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
            
            <!-- Le filtre magique qui s'applique pour les permissions write, create, unlink -->
            <field name="domain_force">[
                    ('state', '=', 'draft'),
                    ('author_id', '=', user.id)
            ]</field>
        </record>

    </data>
</odoo>